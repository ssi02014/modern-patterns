# ğŸ’» Mediator/Middleware

## ê¸°ë³¸ ê°œë…

- Mediator(ì¤‘ì¬ì)íŒ¨í„´ì€ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ì„œë¡œ ì§ì ‘ í†µì‹ í•˜ëŠ” ëŒ€ì‹  `ì¤‘ì¬ì` ì—­í• ì„ í•˜ëŠ” ê°ì²´ë¥¼ í†µí•˜ë„ë¡ í•œë‹¤.
- ì¤‘ì¬ì ê°ì²´ê°€ ìš”ì²­ì„ ë°›ì•„ ì´ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ê°ì²´ë“¤ì—ê²Œ ì „ë‹¬í•˜ëŠ” ê²ƒì´ë‹¤. ì¤‘ì¬ìëŠ” ë³´í†µ ê°ì²´ë‚˜ í•¨ìˆ˜ë¡œ êµ¬í˜„ëœë‹¤.
- í•´ë‹¹ íŒ¨í„´ì€ ê³µí•­ì—ì„œ ë¹„í–‰ê¸°ì˜ ë™ì„ ì„ ê´€ë¦¬í•˜ëŠ” ê´€ì œì†Œì— ë¹„êµí•  ìˆ˜ ìˆë‹¤. ë¹„í–‰ê¸°ë¼ë¦¬ ì§ì ‘ í†µì‹ í•˜ë©´ ì‚¬ê³ ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆê² ì§€ë§Œ ê´€ì œì†Œì—ì„œ ì‚¬ì˜¤í•­ì„ ì „ë‹¬ë°›ì•„ í†µì œë¥¼ í•˜ê²Œ ë˜ë©´ ì„œë¡œ ì¶©ëŒ ì—†ì´ ì•ˆì „í•˜ê²Œ í™œì£¼ë¡œë¥¼ ì´ìš©í•  ìˆ˜ ìˆê²Œëœë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-14 á„‹á…©á„’á…® 5 47 26](https://user-images.githubusercontent.com/64779472/190107279-45adbd2d-3c22-43d6-b9ee-2fa657abce95.png)

- ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¹„í–‰ê¸°ë¥¼ ì¡°ì¢…í•  ì¼ì€ ì—†ê² ì§€ë§Œ, ì¢…ì¢… ì—¬ëŸ¬ ê°ì²´ë“¤ì´ ì„œë¡œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ” ìƒí™©ì´ ìƒê¸°ê³¤í•œë‹¤. ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ ì»´í¬ë„ŒíŠ¸ê°€ ë§ì•„ì§ˆìˆ˜ë¡ í†µì‹ ì˜ íšŸìˆ˜ëŠ” ë§ì•„ì§€ë©° ì ì  íë¦„ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›Œ ì§ˆ ê²ƒì´ë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-14 á„‹á…©á„’á…® 5 48 38](https://user-images.githubusercontent.com/64779472/190107569-64ec8bb7-e9ab-4519-9f82-3f20c22e87f3.png)

- í•˜ì§€ë§Œ, ê°ì²´ë¼ë¦¬ ì„œë¡œ í†µì‹ í•˜ê²Œ í•˜ì—¬ `ë‹¤ëŒ€ë‹¤ ê´€ê³„`ë¥¼ ì´ë£¨ê²Œ í•˜ëŠ” ëŒ€ì‹ , ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ ê°ì²´ì˜ ìš”ì²­ë“¤ì„ ëª¨ë‘ `Mediator(ì¤‘ì¬ì)`ì—ê²Œ ë³´ë‚¸ë‹¤.
- Mediator(ì¤‘ì¬ì)ëŠ” ì´ëŸ° ìš”ì²­ë“¤ì„ ì²˜ë¦¬í•˜ì—¬ ì´ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ê°ì²´ì—ê²Œ ì „ë‹¬í•œë‹¤.

<br />

## ì‚¬ìš© ì‚¬ë¡€ì™€ ì˜ˆì‹œ (1)

- ì‹¤ë¬´ì—ì„œ ì´ Mediator(ì¤‘ì¬ì) íŒ¨í„´ì´ ì í•©í•œ ê³³ì€ `ì±„íŒ…`ì„ êµ¬í˜„í•  ë•Œì´ë‹¤.
- ì±„íŒ… ì•±ì—ì„œ ì‚¬ìš©ìëŠ” ë©”ì‹œì§€ë¥¼ ì§ì ‘ ì„œë¡œ ì£¼ê³  ë°›ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ëŒ€ì‹  `ì±„íŒ… ì„œë²„`ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê³  ì„œë²„ê°€ ê° ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ëŠ” í˜•íƒœì´ë‹¤.

```ts
class ChatRoom {
  logMessage(user: User, message: string) {
    const sender = user.getName();

    return `[${sender}]: ${message}`;
  }
}

class User {
  name: string;
  chatroom: ChatRoom;

  constructor(name: string, chatroom: ChatRoom) {
    this.name = name;
    this.chatroom = chatroom;
  }

  getName() {
    return this.name;
  }

  send(message: string) {
    return this.chatroom.logMessage(this, message);
  }
}

const chatroom = new ChatRoom();

const user1 = new User("Minjae", chatroom);
const user2 = new User("Gromit", chatroom);

user1.send("Hi there!");
user2.send("Hey!");

export { User, ChatRoom };
```

- ìœ„ ì˜ˆì œì—ì„œ ì‚¬ìš©ìëŠ” `ChatRoom`ê³¼ ì—°ê²°ë˜ëŠ” `User`ë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆê³ , ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” `send` ë©”ì„œë“œë¥¼ í†µí•´ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤.

<br />

## ì‚¬ìš© ì‚¬ë¡€ì™€ ì˜ˆì‹œ (2)

- `Express.js`ëŠ” ë§ì´ ì‚¬ìš©í•˜ëŠ” ì›¹ ì„œë²„ í”„ë ˆì„ì›Œí¬ì´ë‹¤. íŠ¹ì • ë¼ìš°íŒ… ê²½ë¡œì— ëŒ€í•´ ì½œë°±ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
- `/`ê²½ë¡œë¡œ ìš”ì²­í–ˆì„ ëŒ€ ìš”ì²­ì— í—¤ë”ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ê³  ê°€ì •í•´ë³´ì. ì•„ë˜ì™€ ê°™ì´ `ë¯¸ë“¤ì›¨ì–´`ë¥¼ ì¶”ê°€í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```js
const app = require("express")();

app.use("/", (req, res, next) => {
  req.headers["test-header"] = 1234;
  next();
});
```

- ìœ„ ì˜ˆì œì—ì„œ `next` í•¨ìˆ˜ëŠ” `ìš”ì²­-ì‘ë‹µ ì‚¬ì´í´`ì— ê±¸ë ¤ìˆëŠ” ë‹¤ìŒ ì½œë°±ì„ í˜¸ì¶œí•œë‹¤. ì¦‰, ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ê°™ì´ ìš”ì²­-ì‘ë‹µ ì‚¬ì´ì— `ì½œë°± ì²´ì¸`ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-14 á„‹á…©á„’á…® 8 16 38](https://user-images.githubusercontent.com/64779472/190139770-378c92d9-a73b-4f76-95e1-64457137cd55.png)

- ì•„ë˜ ì˜ˆì œëŠ” í—¤ë”ê°€ ì˜ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë„ ì¶”ê°€í•˜ì˜€ë‹¤. ì´ëŠ” ì´ì „ ì½œë°±ì˜ ë³€ê²½ ì‚¬í•­ì„ ë‹¤ìŒ ì½œë°±ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•œ ê²ƒì´ë‹¤.
- ì¦‰, ì—”ë“œí¬ì¸íŠ¸ `/`ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ `ë‘ ê°œì˜ ë¯¸ë“¤ì›¨ì–´ ì½œë°±ì´ ì‹¤í–‰`ë˜ëŠ” ê²ƒì´ë‹¤.
- ì´ëŸ¬í•œ ë¯¸ë“¤ì›¨ì–´ íŒ¨í„´ì€ ì—¬ëŸ¬ ê°ì²´ ê°„ `ë‹¤ëŒ€ë‹¤ì˜ í†µì‹ `ì„ í•˜ë‚˜ì˜ `ê´€ë¦¬ í¬ì¸íŠ¸(Mediator)`ë¥¼ í†µí•˜ë„ë¡ ë§Œë“¤ì–´ ê´€ê³„ë¥¼ ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.

```js
const app = require("express")();
const html = require("./data");

// ë¯¸ë“¤ì›¨ì–´
app.use(
  "/",
  (req, res, next) => {
    req.headers["test-header"] = 1234;
    next();
  },
  (req, res, next) => {
    console.log(`Request has test header: ${!!req.headers["test-header"]}`);
    next();
  }
);

app.get("/", (req, res) => {
  res.set("Content-Type", "text/html");
  res.send(Buffer.from(html));
});

app.listen(8080, function () {
  console.log("Server is running on 8080");
});
```

<br />

## í…ŒìŠ¤íŠ¸

```ts
import { ChatRoom, User } from "../mediator";

describe("mediator ë‹¨ìœ„ í…ŒìŠ¤íŠ¸", () => {
  test("ì±„íŒ…ë°© í…ŒìŠ¤íŠ¸", () => {
    const chatroom = new ChatRoom();
    const user1 = new User("Gromit", chatroom);
    const user2 = new User("Minjae", chatroom);

    expect(user1.send("Hi Minjae!")).toBe("[Gromit]: Hi Minjae!");
    expect(user2.send("Hi Gromit!")).toBe("[Minjae]: Hi Gromit!");
  });
});
```
